<h1>{{ 'Library' | translate }}</h1>
<form [formGroup]="libForm" (ngSubmit)="onSubmit()">
  <div class="form-group row">
    <label for="name" class="col-sm-2 col-form-label required">{{ 'Name' | translate }}</label>
    <div class="col-sm-10">
      <input
        class="form-control"
        id="name"
        formControlName="name"
        placeholder="{{ 'Please insert a name' | translate }}"
        required
      >
      <div *ngIf="name.invalid && (name.dirty || name.touched)" class="text-danger">
        <div *ngIf="name.errors.required">
          {{ 'Name is required.' | translate }}
        </div>
        <div *ngIf="name.errors.minlength">
          {{ 'Name must be at least 4 characters long.' | translate }}
        </div>
      </div>
    </div>
  </div>
  <div class="form-group row">
    <label for="address" class="col-sm-2 col-form-label">{{ 'Address' | translate }}</label>
    <div class="col-sm-10">
      <input id="address" class="form-control" formControlName="address">
      <div *ngIf="address.invalid && (address.dirty || address.touched)" class="text-danger">
        <div *ngIf="address.errors.minlength">
          {{ 'Address must be at least 4 characters long.' | translate }}
        </div>
      </div>
    </div>
  </div>
  <div class="form-group row">
    <label for="email" class="col-sm-2 col-form-label">{{ 'Email' | translate }}</label>
    <div class="col-sm-10">
      <input id="email" class="form-control" formControlName="email">
      <div *ngIf="email.invalid && (email.dirty || email.touched)" class="text-danger">
        <div *ngIf="email.errors.email">
          {{ 'Email format is not correct.' | translate }}
        </div>
      </div>
    </div>
  </div>
  <div class="form-group row">
    <label for="email" class="col-sm-2 col-form-label required">{{ 'Code' | translate }}</label>
    <div class="col-sm-10">
      <input
        id="code"
        class="form-control"
        formControlName="code"
        placeholder="{{ 'Please insert a code' | translate }}"
        required
      >
      <div *ngIf="code.invalid && (code.dirty || code.touched)" class="text-danger">
        <div *ngIf="code.errors.isTaken">
          {{ 'Code is already taken.' | translate }}
        </div>
        <div *ngIf="code.pending">{{ 'Validating…' | translate }}</div>
      </div>
    </div>
  </div>

  <tabset #staticTabs>
    <tab heading="{{ 'Opening Hours' | translate }}">
      <div class="mt-3" formArrayName="opening_hours" *ngFor="let day of openingHours.controls; let i=index">
        <div [formGroupName]="i">
          <div class="form-group row">
            <div class="col-2">
              <ui-switch formControlName="is_open" [checked]="day.value.is_open" size="small" defaultBgColor="red"></ui-switch>
              {{ day.value.day | translate | titlecase }}
            </div>
            <div class="col-10">
              <ul class="list-unstyled mb-0">
                <li formArrayName="times" *ngFor="let time of day.controls.times.controls; let t=index">
                  <div [formGroupName]="t" class="mb-1">
                    <div class="form-row">
                      <div class="col-3">
                        <input class="form-control mr-2" formControlName="start_time" [readonly]="!day.value.is_open">
                      </div>
                      <div class="col-3">
                        <input class="form-control" formControlName="end_time" [readonly]="!day.value.is_open">
                      </div>
                      <div class="col-6">
                        <button
                          type="button"
                          *ngIf="day.value.is_open && day.controls.times.controls.length > 1"
                          class="btn btn-light btn-sm"
                          (click)="deleteTime(i, t)"
                        ><i class="fa fa-trash-o" aria-hidden="true"></i></button>
                        <button
                          type="button"
                          *ngIf="day.value.is_open && day.controls.times.controls.length == 1"
                          class="btn btn-light btn-sm"(click)="addTime(i)"
                        ><i class="fa fa-plus" aria-hidden="true"></i> {{ 'period' | translate }}</button>
                      </div>
                    </div>
                    <div
                        *ngIf="time.controls.start_time.invalid && (time.controls.start_time.dirty || time.controls.start_time.touched)"
                        class="text-danger"
                      >
                      <div *ngIf="time.controls.start_time.errors.required">
                        {{ 'Start Time is required.' | translate }}
                      </div>
                      <div *ngIf="time.controls.start_time.errors.pattern">
                        {{ 'Start Time format is not correct.' | translate }}
                      </div>
                    </div>
                    <div
                        *ngIf="time.controls.end_time.invalid && (time.controls.end_time.dirty || time.controls.end_time.touched)"
                        class="text-danger"
                      >
                      <div *ngIf="time.controls.end_time.errors.required">
                        {{ 'End time is required.' | translate }}
                      </div>
                      <div *ngIf="time.controls.end_time.errors.pattern">
                        {{ 'End time format is not correct.' | translate }}
                      </div>
                    </div>
                    <div *ngIf="time.invalid && (time.dirty || time.touched)" class="text-danger">
                      <div *ngIf="time.errors && time.errors.lessThan">
                        {{ 'End time is less than start time.' | translate }}
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
              <div *ngIf="day.invalid  && (day.dirty || day.touched)" class="text-danger">
                <div *ngIf="day.errors && day.errors.rangeLessThan">
                  {{ 'The two periods are overlapping.' | translate }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </tab>
    <tab heading="{{ 'Exceptions (holidays, etc.)' | translate }}">
      <libraries-exception-dates-list [library]="library"></libraries-exception-dates-list>
    </tab>
  </tabset>
  <div class="clearfix">
    <div class="btn-group float-right" role="group" aria-label="Basic example">
      <button type="cancel" class="btn btn-warning" (click)="onCancel()">{{ 'Cancel' | translate }}</button>
      <button type="submit" class="btn btn-success" [disabled]="libForm.invalid">{{ 'Submit' | translate }}</button>
    </div>
  </div>
</form>
