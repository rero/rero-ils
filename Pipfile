# RERO ILS
# Copyright (C) 2020 RERO
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, version 3 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.

[[source]]
url = "https://pypi.org/simple"
verify_ssl = true
name = "pypi"

[packages]
## Python packages dependencies (order matters)
#------------------------------------------------------------------------------
## Note: pipenv evaluates the package constraints from the top to the bottom
## and respects only the last constraint to install the package.
## Thus the most strength constraint should be at the end.
## Imagine the following package list for the foo package with the
## most recent version equal to 5.0:
## A foo Pipfile example:
## ----------------------
## foo = ">1.0" # first will install 5.0
## foo = "==1.0" # then will downgrade to 1.0
## foo = ">3.0" # finally will upgrade to 5.0
## when the python code will be executed a conflict exception will be raised.
#------------------------------------------------------------------------------
# Default from Invenio
Babel = ">=2.4.0"
Flask-BabelEx = ">=0.9.3"
## Third party invenio modules used by RERO ILS
invenio-oaiharvester = {editable = true, git = "https://github.com/inveniosoftware/invenio-oaiharvester.git", ref = "v1.0.0a4"}
invenio-circulation = {editable = true, git = "https://github.com/inveniosoftware/invenio-circulation.git", ref = "v1.0.0a16"}
## Invenio base modules used by RERO ILS
# same as invenio metadata extras without invenio-search-ui
invenio-indexer = ">=1.0.1,<1.1.0"
invenio-jsonschemas = ">=1.0.0,<1.1.0"
invenio-oaiserver = ">=1.0.3,<1.1.0"
invenio-pidstore = ">=1.0.0,<1.1.0"
invenio-records-rest = ">=1.4.0,<1.5.0"
invenio-records-ui = ">=1.0.1,<1.1.0"
## Default from Invenio
invenio = {version = "~=3.1.0",extras = ["base", "postgresql", "auth", "elasticsearch6"]}
uwsgi = ">=2.0"
uwsgitop = ">=0.11"
uwsgi-tools = ">=1.1.1"
## Additionnal constraints on invenio base modules
# TODO: remove when https://github.com/inveniosoftware/invenio-accounts/issues/306 will be solved
invenio-accounts = "<=1.1.2"
# TODO: remove when DynamicPermission will be solved
invenio-access = "<1.2.0"
# separate tables
invenio-records = ">=1.3.0"
# TODO: remove when sqlalchemy.exc.NoInspectionAvailable problem will be solved
SQLAlchemy = "<=1.3.15"
# TODO: remove when email_validator Exception disappears
WTForms = "<2.3.0"
email_validator = "*"
## RERO ILS specific python modules
PyYAML = ">=5.3.1"
dateparser = ">=0.7.0"
isbnlib = ">=3.9.1"
requests = ">=2.20.0"
polib = "*"
pycountry = ">=19.7.15"
xmltodict = "*"
# TODO: to be removed when the thumbnail will be refactored
angular-gettext-babel= ">=0.1"
# Avoid CVE 38107 on bleach <=3.1.3 (dependency of invenio-record-rest)
bleach = ">=3.1.4"
## Additionnal constraints on python modules
# solves datetime serialize error
celery = "<4.3.0"
flask-wiki = {git = "https://github.com/rero/flask-wiki.git"}
markdown-captions = "*"
## Self install
rero-ils = {path = ".", editable = true}
## Deployment
raven = "*"
lxml = ">=3.5.0,<4.2.6"

[dev-packages]
## Python packages development dependencies (order matters)
#----------------------------------------------------------
## Default from Invenio
Flask-Debugtoolbar = ">=0.10.1"
# TODO: run-test.sh: `pipenv run sphinx-build -qnNW docs docs/_build/html crashing
# https://github.com/mozilla-services/python-dockerflow/issues/42
Sphinx = "<3.0.2"
check-manifest = ">=0.35"
coverage = ">=4.4.1"
isort = ">=4.3"
mock = ">=2.0.0"
marshmallow = ">=2.15.1,<3.0.0"
pydocstyle = ">=2.0.0"
pytest = ">=3.3.1"
pytest-cov = ">=2.5.1"
pytest-invenio = ">=1.0.2,<1.1.0"
pytest-mock = ">=1.6.0"
pytest-pep8 = ">=1.0.6"
pytest-random-order = ">=0.5.4"
pytest-runner = ">=3.0.0,<5"
# TODO: safety needs pipenv installed, we will install a working pipenv for us.
pipenv = "==2018.10.9"
# TODO: if new pipenv can check safety again we can delete safety
safety = ">=1.8"
# FIXME: Remove this once this issue is resolved https://github.com/pypa/pipenv/issues/3865.
docutils = "==0.15"
## RERO ILS specific python packages
autoflake = ">=1.3.1"
transifex-client = ">=0.12.5"

[requires]
python_version = "3.6"

[scripts]
test = "python setup.py test"
build_sphinx = "python setup.py build_sphinx"
dev = "pytest --no-cov -vs tests"
bootstrap = "./scripts/bootstrap"
console = "./scripts/console"
setup = "./scripts/setup"
server = "./scripts/server"
update = "./scripts/update"
